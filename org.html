<html>
    <head>
        <title>Organisationsnummer</title>
        <style>
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                padding: 200px;
            }
            input {
                height: 70px;
                width: 400px;
                border-radius: 10px;
                font-size: 22px;
                padding-left: 10px;
            }
            p {
                font-family: Arial,serif;
                font-size: 28px;
            }
        </style>
    </head>
    <body>
        <input placeholder="Fyll i organisationsnummer" type="text" id="orgNumInput" />
        <p id="orgNumOutput" style="display: none;">Bolagsform: <span style="font-weight: bold" id="companyType">&nbsp;</span></p>
        <p id="orgNumInvalid" style="display: none;">Organisationsnumret är ogiltigt</p>
        <br>
        <p id="source" style="font-size: 14px;">Källa: <a href="https://sv.wikipedia.org/wiki/Organisationsnummer">Wikipedia</a></p>
        <script>
            const validLuhn = (val) => {
                return !/^\d+$/.test(val) || (val.split('').reduce(function(sum, d, n){
                    return sum + parseInt(((n + val.length) %2)? d: [0,2,4,6,8,1,3,5,7,9][d]);
                }, 0)) % 10 == 0;
            };


            const source = document.querySelector('#source');
            const orgNumOutput = document.querySelector('#orgNumOutput');
            const orgNumInvalid = document.querySelector('#orgNumInvalid');
            const orgNumInput = document.querySelector('#orgNumInput');
            const companyTypeOutput = document.querySelector('#companyType');

            const orgTypeMap = {
                '1': 'Dödsbo',
                '2': 'Stat / Religion / Kommun / Församling',
                '3': 'Utländskt företag',
                '5': 'Aktiebolag',
                '7': 'Ekonomisk förening / Bostadsrättsförening / Samfällighetsförening',
                '8': 'Ideell förening / stiftelse',
                '9': 'Handelsbolag / Kommanditbolag'
            };

            orgNumInput.addEventListener('change', (e) => {
                let val = e.currentTarget.value.replace('-', '');

                if (val.length === 12) {
                    val = val.substring(2);
                }

                const first = val.substring(0,1);
                const secondPair = parseInt(val.substring(2,4), 10);

                if (val.length !== 10 || !validLuhn(val) || (secondPair > 12 && secondPair < 20)) {
                    orgNumInvalid.style.display = 'block';
                    orgNumOutput.style.display = 'none';
                    companyTypeOutput.innerHTML = 'OGILTIGT';
                    return
                }

                orgNumInvalid.style.display = 'none';
                orgNumOutput.style.display = 'block';

                if (parseInt(secondPair, 10) <= 12) {
                    companyTypeOutput.innerHTML = 'Enskild firma';
                    return;
                }

                companyTypeOutput.innerHTML = orgTypeMap[first];
            });
        </script>
    </body>
</html>
